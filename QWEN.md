# Qwen Code 编程规范

## 项目概述
Linker 是一个用于连接分散在各地的联网设备的工具，让这些设备像在隔壁房间一样轻松访问。项目主要功能包括私有部署、打洞中继、异地组网、端口转发、Socks5代理等。

## 代码风格规范
- **命名约定**：遵循 C# 的标准命名约定，类名使用 PascalCase，方法名使用 PascalCase，私有字段使用 _camelCase 或 camelCase
- **缩进**：使用 4 个空格进行缩进
- **行宽**：建议每行不超过 120 个字符
- **注释**：关键网络逻辑、打洞算法、中继机制等需要添加详细注释，公共 API 需要 XML 文档注释
- **空行**：合理使用空行分隔代码块，提高可读性

## 代码结构规范
- **命名空间**：使用有意义的命名空间组织代码，如与网络、隧道、设备管理相关的功能分类
- **类设计**：遵循 SOLID 原则
- **文件组织**：一个文件通常只包含一个公共类
- **接口使用**：适当使用接口来定义契约，特别是在处理不同类型的网络连接方式时

## 网络功能规范
- **打洞算法**：TCP、UDP、IPV4、IPV6 打洞方法需要清晰的实现和文档
- **中继机制**：支持多中继节点，承载海量设备的连接
- **隧道管理**：管理点对点、点对网、网对网的连接
- **虚拟网卡**：处理虚拟IP分配和网络接口管理

## 通信协议规范
- **异地组网**：实现虚拟网卡的点对点、点对网、网对网连接
- **端口转发**：实现一对一端口转发功能
- **Socks5代理**：实现Socks5代理功能
- **TCP over TCP**：使用tun324为通信提速
- **应用层NAT**：在无法使用系统内置NAT时提供应用层NAT功能

## 管理功能规范
- **Web管理界面**：客户端监听1804端口，通过HTTP+Websocket进行管理
- **防火墙功能**：实现应用层防火墙，精细控制客户端访问权限
- **远程唤醒**：支持WOL魔术包、USB COM继电器、USB HID继电器等方式远程唤醒设备
- **内网穿透**：实现类似FRP的内网穿透功能

## 测试规范
- **单元测试**：每个功能模块都需要有相应的单元测试
- **网络测试**：针对不同网络环境和连接方式进行测试
- **性能测试**：对打洞成功率、连接速度等进行测试
- **测试命名**：测试方法名应该清晰描述测试场景
- **代码覆盖率**：尽量提高代码覆盖率

## 提交规范
- **提交信息**：清晰描述本次提交的内容，特别是涉及网络功能的变更
- **代码审查**：重要变更需要经过代码审查

## 其他约定
- **错误处理**：统一的错误处理方式，特别是网络异常处理
- **日志记录**：使用统一的日志框架和记录格式，便于排查网络连接问题
- **配置管理**：配置信息统一管理，支持不同平台的部署需求

## 文档规范
- **文档格式**：所有文档使用 Markdown 格式编写，使用中文
- **图表规范**：所有图表使用 Mermaid 语法创建，包含但不限于架构图、流程图、时序图等
- **文档存储**：所有文档统一存放在 docs 文件夹下
- **功能分类**：不同功能的文档需要在 docs 文件夹下建立独立的功能文件夹，例如：
  - `docs/network/` - 网络连接相关文档
  - `docs/tunnel/` - 隧道管理相关文档
  - `docs/relay/` - 中继机制相关文档
  - `docs/admin/` - 管理界面相关文档
  - `docs/features/` - 特色功能相关文档

## 工具规范
- **静态分析**：使用 Roslyn 分析器等工具检查代码质量
- **格式化**：使用 .editorconfig 维持代码格式一致性